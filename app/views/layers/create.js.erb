$('#submitModal .modal-footer .close-modal').removeClass('disabled');
$('#submitModal .modal-header .close').removeClass('hide');

$('#submitModal').delegate('[data-dismiss="modal"]', 'click.dismiss.modal', window.VALIDATION.submitModalEvents['submitModal']);
$('.modal-backdrop').click(window.VALIDATION.submitModalEvents['modal-backdrop']);
$(document).on('keyup.dismiss.modal', window.VALIDATION.submitModalEvents['document']);

var random_number = Math.floor(Math.random()*100);
// Update layers
var name = '';
_.each(window.VALIDATION.layers, function(layer, layer_name) {
  _.each(layer.editions, function(edition_properties, edition) {
    name = (edition == 'base' ? layer_name : layer_name + '_' + edition);
    if(window.VALIDATION[name].isVisible()) {
      window.VALIDATION[name].update(window.VALIDATION[name + '_params'].query + " AND " + random_number + " = " + random_number);
    }
  });
});

<% if @layer.errors.any? %>
  $('#submitModal .submit-data').button('reset');
  $('#submitModal .modal-body').removeClass('alert-success').addClass('alert-error').find('.message').html('There was some error while trying to submit the data.')

  var errors = $('<ul></ul>');
  <% @layer.errors.full_messages.each do |error| %>
    errors.append('<li><%= escape_javascript( error ) %></li>');
  <% end %>
  $('#submitModal .modal-body .message').append(errors);
<% else %>
  $('#submitModal .modal-body').removeClass('alert-error').addClass('alert-success').find('.message').html('Successfully submitted, thank you for your contribution.');
  $('#submitModal .modal-footer .submit-data').val('Submission completed');

  $('#main_menu .submit-polygon, #main_menu .erase-polygon').addClass('disabled');
  window.VALIDATION.mapPolygon.getPath().clear();
<% end %>
